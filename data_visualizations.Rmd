---
title: "data_visualizations"
author: "Alicia Fennell"
date: "1/26/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Attach packages
library(tidyverse)
library(tidyr)
library(here)
library(janitor)
library(plotly)
library(kableExtra)
library(effsize)
library(stargazer)
library(broom)
library(plotly)
library(scales)
library(dplyr)
library(ggplot2)
library(ggrepel)
library(forcats)
library(scales)
library(waffle)
library(magrittr)
library(hrbrthemes)
library(lubridate)
```


```{r}
## Pie chart attempts
#Read in ag observations and projections 

ag_observations <- read_csv(here("results", "all_ag_observations.csv"))
ag_predictions <- read_csv(here("results", "all_predictions.csv")) 

## pie chart for composition of land in 2030 and line graph showing percent change 
## Attempting pie chart, starting with bar chart 

ag_acres_30 <- ag_predictions %>% 
  filter(variable == "acres") %>% 
  filter(year == "2030") %>% 
  mutate(percent = value / 745176.317) %>% 
  filter(land_class != "total_allclasses") %>% 
  mutate(across(is.numeric, ~ round(., 4))) %>% 
  mutate(percent_dis = c("2.18%", "6.23%", "0.46%", "2.25%", "8.28%", "5.26%", "75.34%"))

pred_bar <- ggplot(data = ag_acres_30, 
                   aes(x="", 
                       y= percent, 
                      fill= land_class))+
geom_bar(width = 1, stat = "identity")

pred_bar

blank_theme <- theme_minimal()+
  theme(
  axis.title.x = element_blank(),
  axis.title.y = element_blank(),
  panel.border = element_blank(),
  panel.grid=element_blank(),
  axis.ticks = element_blank(),
  plot.title=element_text(size=14, face="bold")
  )

## bar chart to pie chart 
pred_pie <- pred_bar + coord_polar("y", start=45) +
  theme_minimal() +
  scale_fill_manual(values=c("lightsteelblue", "goldenrod", "lightslategrey", "darkred", "darkolivegreen3", "green4", "purple4")) +
  blank_theme +
  guides(fill = guide_legend(title = "Land Classification")) +
  geom_label_repel(aes(label = percent_dis), size=3, show.legend = F, nudge_x = 1)

pred_pie

```


```{r}
## waffle plotting 
## waffle for acreage percentages in 2030
acre_pct_30 <- c("Rangeland"=151,
                 "Row Crops"=17,
                 "Fodder"=12,
                 "Vineyard"=11,
                 "Orchard"=4,
                 "Fallow"=4,
                 "Greenhouse"=1)

waffle(acre_pct_30, rows=10, size=0.6,  
       colors=c("darkolivegreen3", "green4", "goldenrod", "purple4", "darkred", "lightsteelblue", "lightslategrey"),  
       title="2030 Working Lands by Land Classification",
       xlab= expression("1 square" %~~% "0.5% of working lands")) +
  theme(plot.title = element_text(hjust = 0.5))

## waffle for carbon storage percentages in 2030
carbon_pct_30 <- c("Rangeland"=166,
                 "Row Crops"=10,
                 "Fodder"=11,
                 "Vineyard"=7,
                 "Orchard"=4,
                 "Fallow"=2,
                 "Greenhouse"=0)

waffle(carbon_pct_30, rows=10, size=0.6,  
       colors=c("darkolivegreen3", "green4", "goldenrod", "purple4", "darkred", "lightsteelblue", "lightslategrey"),  
       title="2030 Net Carbon by Land Classification",
       xlab= expression("1 square" %~~% "0.5% of net carbon in working lands")) +
  theme(plot.title = element_text(hjust = 0.5))

## waffle for n2o emissions percentages in 2030
n2o_pct_30 <- c("Rangeland"=0,
                 "Row Crops"=133,
                 "Fodder"=28,
                 "Vineyard"=14,
                 "Orchard"=25,
                 "Fallow"=0,
                 "Greenhouse"=0)

waffle(n2o_pct_30, rows=10, size=0.6,  
       colors=c("darkolivegreen3", "green4", "goldenrod", "purple4", "darkred", "lightsteelblue", "lightslategrey"),  
       title="2030 N2O Emissions by Land Classification",
       xlab= expression("1 square" %~~% "0.5% of N2O emissions from working lands")) +
  theme(plot.title = element_text(hjust = 0.5))


# ggplot(data = ag_acres_30) +
#   geom_waffle(aes(fill = land_class, 
#            values = percent)) +
#   scale_fill_manual(
#     values=c("lightsteelblue", "goldenrod", "lightslategrey", "darkred", "darkolivegreen3", "green4", "purple4"),
#     labels = c("Fruit", "Sammich", "Pizza", "test", "testag", "woo", "last")
#   ) +
#   coord_equal() +
#   theme_ipsum_rc(grid="") +
#   theme_enhance_waffle()
# 
# 
# waffle(ag_acres_30, rows=7, size=0.5, 
#        colors=c("lightsteelblue", "goldenrod", "lightslategrey", "darkred", "darkolivegreen3", "green4", "purple4"), 
#        title="Average Household Savings Each Year", 
#        xlab="1 square == $392")
```


```{r}
## Acreage change over time
## read in wide data 
pred_wide <- read_csv(here("results", "predictions_wide.csv")) 

## trying to make a dataframe to have percent change over time of ag acreage 
acres_predict <- final_predict_df %>% 
  filter(year %in% c(2012, 2030)) %>% 
  filter(variable == "acres") %>% 
  group_by(land_class) %>% 
  mutate(year = year(year)) %>% 
  mutate(pct_change = (value - lag(value))/lag(value))

## just rangelands
# ggplot(data = pred_wide)+
#   geom_line(aes(x = year, y = acres_rangeland))+
#   geom_line(aes(x = year, y = net_rangeland))
#   theme_minimal()

## 
ggplot(data = tidy_predict_df, aes(x = year, y = value, group = variable))+
  geom_line(aes(color = variable))+
  theme_minimal()+
  facet_wrap(~land_class, scales = "free_y")

## 
ggplot(data = tidy_predict_df, aes(x = year, y = value, group = land_class))+ 
  geom_line(aes(color = land_class))+
  theme_minimal()+ 
  facet_wrap(~variable, scales = "free_y")

## only acres and net 
ggplot(data = subset(tidy_predict_df, variable %in% c("acres", "net")), aes(x = year, y = value, group = land_class))+
  geom_line(aes(color = land_class))+
  theme_minimal()+
  facet_wrap(~variable, scales = "free_y")
```


